<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Terminal List PWA</title>
  <!-- PWA refs -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#32cd32">
  <style>
    :root{
      --bg: #000;
      --fg: #32cd32; /* limegreen */
      --border: #32cd32;
      --font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --header-h: 56px;
      --input-h: 52px;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--font);
      overflow: hidden;
    }
    #header{
      position: fixed; top: 0; left: 0; right: 0;
      height: var(--header-h);
      padding: 6px 10px;
      border-bottom: 1px solid var(--border);
      background: var(--bg);
      z-index: 1000;
      line-height: 1.2;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    #header .left{
      display: flex;
      flex-direction: column;
    }
    #installBtn{
      background: transparent;
      color: var(--fg);
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-family: var(--font);
      cursor: pointer;
      display: none; /* shown when beforeinstallprompt fires */
    }
    #output{
      position: absolute;
      top: var(--header-h);
      left: 0; right: 0;
      bottom: calc(var(--input-h) + env(safe-area-inset-bottom));
      padding: 10px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      box-sizing: border-box;
    }
    #input-bar{
      position: fixed; left: 0; right: 0;
      height: var(--input-h);
      bottom: env(safe-area-inset-bottom);
      border-top: 1px solid var(--border);
      background: var(--bg);
      z-index: 1000;
      display: flex; align-items: center; gap: 8px;
      padding: 6px 10px; box-sizing: border-box;
      transform: translateY(0);
      will-change: transform;
    }
    #prompt-label{ user-select: none; white-space: pre; }
    #command{
      flex: 1; min-width: 0;
      background: transparent; color: var(--fg);
      border: 0; outline: none; caret-color: var(--fg);
      font-family: var(--font); font-size: 16px;
    }
    .line{ white-space: pre-wrap; word-break: break-word; }
    .muted{ opacity: 0.85; }
    .error{ color: #ff4d4d; } /* subtle red for errors */
    .ok{ color: #7fffd4; }  /* aquamarine for confirms */
    .task-done{ opacity: 0.7; text-decoration: line-through; }
    /* Modal */
    #modal{
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(0,0,0,0.92);
      z-index: 2000;
    }
    #modal .card{
      border: 1px solid var(--border);
      padding: 16px 20px;
      width: min(520px, calc(100% - 40px));
      background: #000;
      box-sizing: border-box;
    }
    .row{ display:flex; gap:10px; margin-top:14px; justify-content:flex-end; }
    button.terminal{
      background: transparent; color: var(--fg);
      border: 1px solid var(--border);
      padding: 8px 14px; font-family: var(--font);
      cursor: pointer;
    }
    button.terminal:hover{ outline: 1px dashed var(--border); }
  </style>
</head>
<body>
  <div id="header">
    <div class="left">
      <div class="title">TERMINAL LIST PWA</div>
      <div class="subtitle">Type HELP to begin</div>
    </div>
    <button id="installBtn">Install</button>
  </div>

  <div id="output" role="log" aria-live="polite"></div>

  <div id="input-bar" role="group" aria-label="Command input">
    <span id="prompt-label">&gt; </span>
    <input id="command" type="text" inputmode="text" autocapitalize="none"
           autocomplete="off" spellcheck="false" placeholder="enter command..." />
  </div>

  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="wipe-title">
    <div class="card">
      <div id="wipe-title" class="line">Confirm WIPE</div>
      <div class="line" style="margin-top:6px">Are you sure you want to WIPE all data?</div>
      <div class="row">
        <button class="terminal" id="btn-cancel">Cancel</button>
        <button class="terminal" id="btn-confirm">WIPE</button>
      </div>
    </div>
  </div>

  <script>
    // Basic app code remains (tasks/notes) â€” omitted here for brevity in this snippet.
    // This file assumes your existing app logic is present below.

    // --- PWA: Service worker registration ---
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js").catch(console.error);
    }

    // --- PWA: Install button via beforeinstallprompt ---
    const installBtn = document.getElementById('installBtn');
    let deferredPrompt = null;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-block';
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      installBtn.disabled = true;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      // Reset
      deferredPrompt = null;
      installBtn.style.display = 'none';
      installBtn.disabled = false;
      console.log('PWA install:', outcome);
    });

    window.addEventListener('appinstalled', () => {
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    // --- VisualViewport pinning for mobile keyboard (kept) ---
    (function pinBottom(){
      const output = document.getElementById('output');
      const inputBar = document.getElementById('input-bar');
      const vv = window.visualViewport;
      if (!vv) return;
      function reposition(){
        const obscured = Math.max(0, (window.innerHeight - (vv.height + vv.offsetTop)));
        inputBar.style.transform = 'translateY(' + (-obscured) + 'px)';
        const inputH = inputBar.getBoundingClientRect().height;
        output.style.bottom = 'calc(' + inputH + 'px + env(safe-area-inset-bottom) + ' + obscured + 'px)';
      }
      vv.addEventListener('resize', reposition);
      vv.addEventListener('scroll', reposition);
      window.addEventListener('orientationchange', ()=>setTimeout(reposition, 50));
      window.addEventListener('resize', reposition);
      window.requestAnimationFrame(reposition);
    })();
  </script>

  <!-- Keep the rest of your existing JS app logic here (tasks/notes, modal, etc.) -->

</body>
</html>
